---
version: '2'
services:
  plex:
    image: plexinc/pms-docker
    container_name: plex
    volumes:
      - /opt/appdata/plex:/config
      - /mnt/storage:/data
    network_mode: host
    restart: always
    environment:
      - PLEX_CLAIM="nope"
      - PUID=${PUID}
      - PGID=${PGID}

  plexpy:
    image: linuxserver/plexpy
    container_name: plexpy
    depends_on:
      - plex
    volumes:
      - /opt/appdata/plexpy:/config
      - /opt/appdata/plex/Library/Application\ Support/Plex\ Media\ Server/Logs:/logs:ro
    ports:
      - 27029:8181
    links:
      - plex
    restart: always
    environment:
      - PUID=${PUID}
      - PGID=${PGID}

  nzbget:
    image: linuxserver/nzbget
    container_name: nzbget
    volumes:
      - /opt/appdata/nzbget/config:/config
      - /opt/downloads:/downloads
      - /mnt/disk1/downloads/complete:/downloads/complete
    ports:
      - 27020:6789
    restart: always
    environment:
      - PUID=${PUID}
      - PGID=${PGID}

  sonarr:
    image: linuxserver/sonarr
    container_name: sonarr
    depends_on:
      - nzbget
    volumes:
      - /opt/appdata/sonarr:/config
      - /mnt/storage/tv:/tv
      - /mnt/disk1/downloads/complete/tv:/downloads
      - /mnt/storage/downloads/complete/tv_import:/tv_import
    ports:
      - 27021:8989
    links:
      - nzbget
    restart: always
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      
  radarr:
    image: linuxserver/radarr
    container_name: radarr
    volumes:
      - /opt/appdata/radarr:/config
      - /mnt/storage/movies:/movies
      - /mnt/disk1/downloads/complete/movies:/downloads
    ports:
      - 7878:7878
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    restart:
      always

  rutorrent:
    image: linuxserver/rutorrent
    container_name: rutorrent
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    volumes:
      - /opt/appdata/rutorrent/config:/config
      - /mnt/disk1/downloads:/downloads
      - /mnt/storage:/mnt/storage
    ports:
      - 80:80
      - 5000:5000
      - 51413:51413
      - 6881:6881/udp
    restart: unless-stopped

  sync:
    image: linuxserver/resilio-sync
    container_name: sync
    volumes:
      - /opt/appdata/sync:/config
      - /mnt/storage:/sync
    ports:
      - 27028:8888
      - 55555:55555
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    restart: always

  smokeping:
    image: linuxserver/smokeping
    container_name: smokeping
    volumes:
      - /opt/appdata/smokeping/config:/config
      - /opt/appdata/smokeping/data:/data
    ports:
      - 27025:81
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
    restart: always

  letsencrypt:
    image: linuxserver/letsencrypt
    container_name: letsencrypt
    ports:
      - 443:443
    volumes:
      - /opt/appdata/letsencrypt:/config
    restart:
      always
    environment:
      - PUID=${PUID}
      - PGID=${PGID}
      - EMAIL=kennykristiansen@hotmail.com
      - URL=domain.tld
      - SUBDOMAINS=one,sub,domain,comma,separated
      - ONLY_SUBDOMAINS=true
      - DHLEVEL=4096
      - TZ=Europe/London

  airsonic-advanced:
    image: airsonicadvanced/airsonic-advanced:latest
    container_name: airsonicadvanced
    restart: unless-stopped
    hostname: ${DOCKERHOSTNAME}
    volumes:
      - /opt/appdata/airsonic:/config
      - /mnt/storage/music/flac:/music/flac
      - /opt/appdata/airsonic/var/playlists:/var/playlists
      - /opt/appdata/airsonic/var/podcasts:/var/podcasts
      - /opt/appdata/airsonic/var/airsonic:/var/airsonic
      - /opt/appdata/airsonic/var/music:/var/music

    environment:
     - PGID=${PGID}
     - PUID=${PUID}
     - TZ=${TZ}
     - CONTEXT_PATH=/music
     - JAVA_OPTS=-Dserver.use-forward-headers=true

  influxdb:
    image: influxdb:latest
    container_name: influxdb
    restart: always
    ports:
      - 8086:8086
    volumes:
      - /opt/appdata/influxdb:/var/lib/influxdb
      - /opt/appdata/influxdb:/var/lib/influxdb2
      - /opt/appdata/influxdb/etc:/etc/influxdb2
    restart:
      always

  grafana:
    image: grafana/grafana
    container_name: grafana
    restart: always
    ports:
      - 3002:3000
    volumes:
      - /opt/appdata/grafana:/var/lib/grafana
    restart:
      always

  plex-meta-manager:
    image: meisnate12/plex-meta-manager
    stdin_open: true # docker run -i 
    tty: true        # docker run -t

    hostname: ${DOCKERHOSTNAME}
    command: -c /config/config.yml -t 03:00
    environment:
     - PGID=${PGID}
     - PUID=${PUID}
     - TZ=${TZ}
    container_name: plex-meta-manager
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - /opt/appdata/plex-meta-manager:/config:rw
      - /mnt/storage:/storage

  bazarr:
    image: ghcr.io/linuxserver/bazarr
    container_name: bazarr
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - /opt/appdata/bazarr/config:/config
      - /mnt/storage/movies:/movies #optional
      - /mnt/storage/tv:/tv #optional
    ports:
      - 6767:6767
    restart: unless-stopped

  jackett:
    image: ghcr.io/linuxserver/jackett
    container_name: jackett
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
      - AUTO_UPDATE=true #optional
      - RUN_OPTS=<run options here> #optional
    volumes:
      - /opt/jackett/config:/config
      - /mnt/disk1/downloads:/downloads
    ports:
      - 9117:9117
    restart: unless-stopped

  portainer:
    container_name: portainer
    image: portainer/portainer-ce:2.0.0
    command: -H unix:///var/run/docker.sock
    restart: always
    ports:
      - 9000:9000
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - /opt/appdata/portainer/data:/data

  nzbhydra2:
    image: ghcr.io/linuxserver/nzbhydra2
    container_name: nzbhydra2
    environment:
      - PUID=1000
      - PGID=1000
      - TZ=Europe/London
    volumes:
      - /opt/nzbhydra2/config:/config
      - /mnt/disk1/downloads:/downloads
    ports:
      - 5076:5076
    restart: unless-stopped